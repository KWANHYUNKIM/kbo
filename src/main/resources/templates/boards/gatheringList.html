<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<!-- Todo: 최신순 css 문제로 값이 재대로 안나오고, 검색했을때 table과 매핑을 안해놔서 값이 재대로안나온다. 그리고 검색은 원래부터 잘안되서 확인해볼 필요있음.-->
<head th:replace="club/head :: boardButton"></head>
<head>
  <style>
    .btn-banner{
      color: black;
      position: absolute;
      top: 30px;
      left: 90px;
      transform: translate(-50%, -50%); /* 버튼을 정확한 중앙으로 이동시킵니다. */
      font-size: 20px;
      font-weight: bold;
    }
    .btn-banner-comment{
      color: black;
      position: absolute;
      top: 60px;
      left: 180px;
      transform: translate(-50%, -50%); /* 버튼을 정확한 중앙으로 이동시킵니다. */
      font-size: 14px;
    }

    .btn-writer {
      background-color: #0f99e3;
      color: white;
      padding: 10px 20px; /* 원하는 패딩값 설정 */
      border: none; /* 기본 테두리 제거 */
      cursor: pointer; /* 커서 모양 변경 */
      border-radius: 5px; /* 반지름을 높이의 절반으로 설정 */
      font-size: 12px;
      width: 85px;
      height: 40px;
    }
    .sort-bnt{
      border-width: 1.0px;
      cursor: pointer; /* 커서 모양 변경 */
      border-radius: 5px; /* 반지름을 높이의 절반으로 설정 */
      font-size: 12px;
      background-color: white;
      width: 85px;
      height: 40px;
      margin-right : 10px;

    }
    .sort-dropdown {
      position: relative;
      display: inline-block;
    }

    .sort-dropdown-content {
      display: none;
      position: absolute;
      background-color: #f1f1f1;
      min-width: 160px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
    }

    .sort-dropdown-content a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      text-align: center;
      display: block;
    }

    .sort-dropdown-content a:hover {
      background-color: #ddd;
    }

    .cc-tab-item{
      border-width: 1.0px;
      cursor: pointer; /* 커서 모양 변경 */
      border-radius: 5px; /* 반지름을 높이의 절반으로 설정 */
      font-size: 12px;
      background-color: white;
      width: 85px;
      height: 40px;
      margin-right : 10px;
      border: none;
    }
    .sort-bnt{
      border-width: 0.1px;
      cursor: pointer; /* 커서 모양 변경 */
      border-radius: 5px; /* 반지름을 높이의 절반으로 설정 */
      font-size: 12px;
      width: 85px;
      height: 40px;
      margin-right : 10px;
      border-color: #d0c6c6;
    }

    .cc-tab-item:first-child { margin-left: 0; }
    /*.cc-tab-item:hover { color: #ed3e64; }*/
    .cc-tab-item.on { cursor: default; line-height: 45px; color: #ed3e64; border-bottom: 0 none; z-index: 8; }
  </style>
</head>


<script>
  function toggleDropdown() {
    var dropdownContent = document.getElementById("dropdownContent");
    dropdownContent.classList.toggle("show");
  }

  function sortBoards(order) {
    // 선택된 순서에 따라 정렬 로직을 구현합니다.
    console.log("게시판을 다음 순서로 정렬합니다: " + order);

    // 버튼 이름 변경
    var sortButton = document.getElementById("sortButton");
    switch (order) {
      case 'latest':
        sortButton.textContent = '최신순';
        break;
      case 'recommend':
        sortButton.textContent = '추천수';
        break;
      case 'comment':
        sortButton.textContent = '댓글순';
        break;
      case 'scrap':
        sortButton.textContent = '스크랩순';
        break;
      case 'view':
        sortButton.textContent = '조회순';
        break;
    }

    // 옵션을 선택한 후 드롭다운을 닫습니다.
    toggleDropdown();
  }

  // 사용자가 드롭다운 외부를 클릭하면 드롭다운을 닫습니다.
  window.onclick = function (event) {
    if (!event.target.matches('#sortButton')) {
      var dropdowns = document.getElementsByClassName("sort-dropdown-content");
      var i;
      for (i = 0; i < dropdowns.length; i++) {
        var openDropdown = dropdowns[i];
        if (openDropdown.classList.contains('show')) {
          openDropdown.classList.remove('show');
        }
      }
    }
  }
</script>

<div class="container">
  <div class="row">
    <div class="col-12">
      <head th:replace="layout/header::userHead"></head>
      <header th:replace="layout/topOverTop::topOverTop"></header>
      <header th:replace="layout/top::header_main"></header>
    </div>
  </div>
</div>

<body>
<div class="container">
  <div class = "row">
    <!-- banner#2 -->
    <div class="col-lg-12">
      <div>
        <img class="banner_2 w-100" src="/images/banner/banner_2.png" alt="광고 이미지" style="height: 85px;">
        <p class="btn-banner">커뮤니티</p>
        <p class="btn-banner-comment">다양한 사람을 만나고 생각의 폭을 넓혀보세요.</p>
      </div>
    </div>
  </div>

  <div class="row" style="padding-top: 20px;">
    <!-- 커뮤니티 -->
    <div class="col-lg-12" style="display: flex; ">

      <!-- 글작성 -->
      <div class="container" style="justify-content: left">
        <form th:action="@{/members/board}" method="GET" style="padding-inline: 15px;">
          <button class="btn-writer" type="submit">작성하기</button>
        </form>
      </div>
      <!-- 사는 얘기 / 모임 / 전체 -->
      <div class ="container" style="justify-content: space-between; display: flex;">
        <a href="javascript:tabChange('1');" class="cc-tab-item">사는얘기</a>
        <a href="javascript:tabChange('2');" class="cc-tab-item on">모임</a>
        <a href="javascript:tabChange('3');" class="cc-tab-item">전체</a>
      </div>

      <div class="container" style="text-align: right">
        <!-- Todo: sort -> 데이터 전송 -> 정렬 -->
        <div class="sort-dropdown">
          <button class="sort-bnt" id="sortButton" onclick="toggleDropdown()">최신순</button>
          <div class="sort-dropdown-content" id="dropdownContent">
            <a href="#" onclick="sortBoards('latest')">최신순</a>
            <a href="#" onclick="sortBoards('recommend')">추천수</a>
            <a href="#" onclick="sortBoards('comment')">댓글순</a>
            <a href="#" onclick="sortBoards('scrap')">스크랩순</a>
            <a href="#" onclick="sortBoards('view')">조회순</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div>
    <hr>
  </div>

  <div class="row" style="padding-top: 20px;">
    <div class="col-lg-12">

      <div style="display: flex; float: left;">
        <img src="/images/icons/refresh.png" style="width: 25px; height: 25px;" id="refreshButton" onclick="refreshPage()">
      </div>

      <div style="justify-content: center; display: flex; align-items: center;">
        <form th:action="@{/boards/search}" method="GET" style="display: flex;">
          <input style="width: 200px; height: 30px; border-radius: 15px; border-color: #e3dfdf" type="text" id="query" name="query" placeholder="커뮤니티 내에서 검색">
          <button style="border: none; background: none; position: relative" type="submit">
            <img src="/images/icons/search.png" alt="Search" style="width: 23px; height: 23px; position: relative;">
          </button>
        </form>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-12" style="font-size: 12px; padding-top: 20px">
      <div class="container">
        <hr>
      </div>

      <div th:each="board, loop : ${paging.content}" style="display: flex; align-items: center; padding-top: 10px;">
        <div th:if="${not board.content.isEmpty()}" style=" margin-left: 20px; width: 100%">
          <img style="display: inline; border-radius: 50%;" th:if="${board.account.filepath != null}" th:src="${board.account.filepath}" height="32" width="32" title="profile">
          <a style="margin-left: 5px; font-size: 12px; display: inline; color: black" th:href="@{/users/{userId}/activity(accountId=${board.account.id}, userId=${board.account.id})}"
             th:text="${board.account.username}"></a>

          <div style="display: inline-block; position: relative; margin-left: 10px;">
            <img src="/images/icons/level.png" style="width: 26px; height: 26px;">
            <p style="position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%); font-size: 10px; margin: 0;" th:text="${board.account.experience.level}"></p>
          </div>

          <h6 style="display: inline; margin-left: 10px;" id="timeDifference"></h6>
          <p style="display: inline; font-size: 12px;" th:text="${board.createdDate.year} + '-' + ${board.createdDate.monthValue} + '-' + ${board.createdDate.dayOfMonth}"></p>

          <div class="container" style="padding: 10px">
            <a th:href="@{/boards/{boardId}/detail(boardId=${board.id})}" th:text="${board.title}" style="color: black"></a>
          </div>

          <div class="container">
            <hr>
          </div>
        </div>
      </div>
      <!-- 변경된 위치로 이동 -->
      <div th:if="${board.isEmpty()}">
        <td colspan="13">No records found</td>
      </div>
      <!-- 페이징 처리 시작 -->
      <div th:if="${paging.totalPages > 1}">
        <ul class="pagination justify-content-center">
          <li class="page-item" th:classappend="${!paging.hasPrevious()} ? 'disabled'">
            <a class="page-link" th:href="@{|/record/all?page=${paging.number-1}|}">
              <span>이전</span>
            </a>
          </li>
          <li th:each="page: ${#numbers.sequence(0, paging.totalPages-1)}"
              th:classappend="${page == paging.number} ? 'active'"
              class="page-item">
            <a th:text="${page + 1}" class="page-link" th:href="@{|/boards/all?page=${page}|}"></a>
          </li>
          <li class="page-item" th:classappend="${!paging.hasNext()} ? 'disabled'">
            <a class="page-link" th:href="@{|/boards/all?page=${paging.number+1}|}">
              <span>다음</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
<script>
  // JavaScript 코드
  function refreshPage() {
    // 현재 페이지를 리플레쉬하는 함수
    location.reload(true);
  }
</script>

<script>
  // 현재 URL이 'boards/all'인 경우 버튼 색상을 변경
  window.onload = function () {
    var currentUrl = window.location.pathname;
    alert("경보");
    if (currentUrl === '/boards/all') {
      var button = document.getElementById('allBoardsButton');
      button.classList.add('active'); // 클릭 효과를 추가
      button.style.backgroundColor = 'red'; // 원하는 색상으로 변경
    }
  };
</script>

</body>
</html>